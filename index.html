<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Meu Espaço — Progresso de Jogos (Cozy)</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  :root{
    /* light palette (cards) */
    --card-bg: #fff8f2;
    --card-cream: #FFF1E6;
    --text: #3f3a33;
    --muted: #6a6058;
    --moss: #7A8B6F;
    --moss-soft: #C6D6BF;
    --accent: #EDE7E1;
    --shadow: rgba(11,10,8,0.06);
    --page-bg: linear-gradient(180deg, #FBFAF7 0%, #F6F4EE 100%);
  }

  /* dark-mode overrides (applied when .dark class is on <html>) */
  .dark {
    --page-bg: linear-gradient(180deg, #0f1912 0%, #121812 100%); /* deep mossy */
    --card-bg: #fffaf1; /* keep cards light but slightly toned */
    --card-cream: #F6F2EA;
    --text: #ece9e1;
    --muted: #bfb8ad;
    --moss: #95a682;
    --moss-soft: #40503c;
    --accent: #222922;
    --shadow: rgba(0,0,0,0.4);
  }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    font-family:Inter,system-ui,Arial;
    color:var(--text);
    background:var(--page-bg);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:18px;
  }

  .wrap{max-width:980px;margin:8px auto;padding:20px}
  .header{display:flex;gap:14px;align-items:center;margin-bottom:16px}
  .brand{
    width:64px;height:64px;border-radius:14px;
    background:linear-gradient(135deg,var(--moss-soft),#E9E6DE);
    display:flex;align-items:center;justify-content:center;
    box-shadow:0 8px 24px var(--shadow);
    font-family:'Playfair Display',serif;color:var(--text);font-size:26px;
  }
  h1{font-family:'Playfair Display',serif;font-size:20px;margin:0;color:var(--text)}
  .subtitle{font-size:13px;color:var(--muted);margin-top:6px}

  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
    gap:14px;margin-top:18px;
  }

  .card{
    background: linear-gradient(180deg, var(--card-bg) 0%, var(--card-cream) 100%);
    border-radius:16px;padding:14px;box-shadow:0 10px 28px var(--shadow);
    display:flex;flex-direction:column;gap:10px;position:relative;overflow:hidden;
    transition:transform .22s ease, box-shadow .22s ease;
  }
  .card:hover{transform:translateY(-6px); box-shadow:0 24px 48px rgba(0,0,0,0.14)}
  .cover{height:120px;border-radius:10px;overflow:hidden;background:#f2efe9;display:flex;align-items:center;justify-content:center}
  .cover img{width:100%;height:100%;object-fit:cover;display:block}
  .title{font-weight:600;font-size:15px;margin:0;color:var(--text)}
  .meta{font-size:12px;color:var(--muted)}
  .progressBack{height:12px;border-radius:999px;background:linear-gradient(90deg,#f6f3ef,#efe9df);overflow:hidden;border:1px solid rgba(0,0,0,0.03)}
  .progressBar{height:12px;border-radius:999px;background:linear-gradient(90deg,var(--moss),#d7e3b8);width:0%;transition:width:700ms cubic-bezier(.2,.8,.2,1)}
  .statusBadge{padding:6px 9px;border-radius:999px;background:rgba(255,255,255,0.8);font-size:12px;color:var(--muted);border:1px solid rgba(0,0,0,0.04);display:inline-flex;gap:8px;align-items:center}

  footer.small{margin-top:18px;font-size:13px;color:var(--muted);text-align:center}

  /* small screens */
  @media (max-width:420px){
    .brand{width:52px;height:52px;font-size:20px}
    .cover{height:100px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">☾☀︎</div>
      <div>
        <h1>Meu Espaço — Progresso de Jogos</h1>
        <div class="subtitle">Cartões cozy — atualize a planilha e o widget reflete as mudanças.</div>
      </div>
    </div>

    <div id="grid" class="grid">
      <div class="card" id="loadingCard" style="text-align:center;opacity:0.9">
        <div style="height:110px;display:flex;align-items:center;justify-content:center;color:var(--muted)">Carregando seus jogos…</div>
      </div>
    </div>

    <footer class="small">Design cozy • atualizações via Google Sheets</footer>
  </div>

<script>
/* ---------- THEME HANDLING ---------- */
/* If the URL contains ?theme=dark -> force dark.
   Otherwise use prefers-color-scheme to set dark automatically. */
(function applyTheme(){
  const urlParams = new URLSearchParams(location.search);
  const forced = urlParams.get('theme');
  if(forced === 'dark'){ document.documentElement.classList.add('dark'); return; }
  if(forced === 'light'){ document.documentElement.classList.remove('dark'); return; }
  // auto-detect
  if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches){
    document.documentElement.classList.add('dark');
  }
})();

/* ---------- DATA & RENDER ---------- */
const DATA_URL = "https://docs.google.com/spreadsheets/d/11SMM610HvJDn1WJBHsQtsTS-Uz9CNMIaRV4YNBPbtBo/gviz/tq?tqx=out:json&sheet=Sheet1";

/* helper to parse gviz wrapper */
function parseGviz(respText){
  const jsonText = respText.replace(/^[^\{]*/, '').replace(/\);?$/, '');
  return JSON.parse(jsonText);
}

/* small placeholder image */
const placeholderImg = "data:image/svg+xml;utf8," + encodeURIComponent(
  `<svg xmlns='http://www.w3.org/2000/svg' width='600' height='400' viewBox='0 0 600 400'>
    <rect width='100%' height='100%' fill='#f2efe9'/>
    <text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#a79d91' font-family='Inter,Arial' font-size='18'>imagem indisponível</text>
  </svg>`
);

async function load(){
  try{
    const res = await fetch(DATA_URL);
    if(!res.ok) throw new Error('fetch status ' + res.status);
    const text = await res.text();
    const json = parseGviz(text);
    const rows = json.table.rows.map(r => ({
      titulo:    r.c[0]?.v || "",
      plataforma:r.c[1]?.v || "",
      progresso: Math.round((r.c[2]?.v || 0) * 100),
      horas:     r.c[3]?.v || 0,
      status:    r.c[4]?.v || "",
      capa:      r.c[5]?.v || "",
      nota:      r.c[6]?.v || "",
      resumo:    r.c[7]?.v || ""
    }));
    render(rows);
  }catch(e){
    console.error(e);
    const grid = document.getElementById('grid');
    grid.innerHTML = `<div class="card" style="text-align:center">Erro ao carregar dados — ver console.</div>`;
  }
}

function makeBadgeHTML(status){
  const s = (status||"").toLowerCase();
  let icon = '☘';
  if(s.includes('platin')) icon = '★';
  if(s.includes('jog')) icon = '⏱';
  if(s.includes('conclu')||s.includes('zer')) icon = '✓';
  return `<span class="statusBadge"><span style="font-weight:600">${status}</span> <span style="opacity:.8;margin-left:6px">${icon}</span></span>`;
}

function render(list){
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  if(!list.length){ grid.innerHTML = `<div class="card">Sem jogos na planilha</div>`; return; }

  list.forEach(g=>{
    const c = document.createElement('div'); c.className='card';
    const imgSrc = g.capa || placeholderImg;
    c.innerHTML = `
      <div class="cover"><img src="${imgSrc}" alt="${escapeHtml(g.titulo)}" onerror="this.onerror=null;this.src='${placeholderImg}'"></div>
      <div><div class="title">${escapeHtml(g.titulo)}</div><div class="meta">${escapeHtml(g.plataforma)} • ${g.horas ? g.horas+'h' : '—'}</div></div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
        <div>⭐ ${g.nota || '—'}</div>
        <div>${makeBadgeHTML(g.status)}</div>
      </div>
      <div style="margin-top:8px"><div class="progressBack"><div class="progressBar" style="width:${g.progresso}%"></div></div></div>
      <div class="meta" style="margin-top:8px">${escapeHtml(g.resumo)}</div>
    `;
    grid.appendChild(c);
  });

  // animate bars
  requestAnimationFrame(()=> {
    document.querySelectorAll('.progressBar').forEach(el=>{
      const w = el.style.width; el.style.width='0%';
      setTimeout(()=> el.style.width = w, 40);
    });
  });
}

function escapeHtml(s){ return (s||'').toString().replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'","&#39;"); }

load();
</script>
</body>
</html>
